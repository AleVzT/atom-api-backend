var be=Object.create;var Y=Object.defineProperty;var je=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames;var Ee=Object.getPrototypeOf,Ie=Object.prototype.hasOwnProperty;var M=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Pe=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Se(e))!Ie.call(t,o)&&o!==r&&Y(t,o,{get:()=>e[o],enumerable:!(s=je(e,o))||s.enumerable});return t};var Ne=(t,e,r)=>(r=t!=null?be(Ee(t)):{},Pe(e||!t||!t.__esModule?Y(r,"default",{value:t,enumerable:!0}):r,t));var re=M((tt,te)=>{"use strict";var ee=Object.getOwnPropertySymbols,He=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable;function Je(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function Le(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;var s=Object.getOwnPropertyNames(e).map(function(i){return e[i]});if(s.join("")!=="0123456789")return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(i){o[i]=i}),Object.keys(Object.assign({},o)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}te.exports=Le()?Object.assign:function(t,e){for(var r,s=Je(t),o,i=1;i<arguments.length;i++){r=Object(arguments[i]);for(var u in r)He.call(r,u)&&(s[u]=r[u]);if(ee){o=ee(r);for(var m=0;m<o.length;m++)Fe.call(r,o[m])&&(s[o[m]]=r[o[m]])}}return s}});var ae=M((rt,z)=>{"use strict";z.exports=_e;z.exports.append=oe;var qe=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/;function oe(t,e){if(typeof t!="string")throw new TypeError("header argument is required");if(!e)throw new TypeError("field argument is required");for(var r=Array.isArray(e)?e:se(String(e)),s=0;s<r.length;s++)if(!qe.test(r[s]))throw new TypeError("field argument contains an invalid header name");if(t==="*")return t;var o=t,i=se(t.toLowerCase());if(r.indexOf("*")!==-1||i.indexOf("*")!==-1)return"*";for(var u=0;u<r.length;u++){var m=r[u].toLowerCase();i.indexOf(m)===-1&&(i.push(m),o=o?o+", "+r[u]:r[u])}return o}function se(t){for(var e=0,r=[],s=0,o=0,i=t.length;o<i;o++)switch(t.charCodeAt(o)){case 32:s===e&&(s=e=o+1);break;case 44:r.push(t.substring(s,e)),s=e=o+1;break;default:e=o+1;break}return r.push(t.substring(s,e)),r}function _e(t,e){if(!t||!t.getHeader||!t.setHeader)throw new TypeError("res argument is required");var r=t.getHeader("Vary")||"",s=Array.isArray(r)?r.join(", "):String(r);(r=oe(s,e))&&t.setHeader("Vary",r)}});var ne=M((st,ie)=>{"use strict";(function(){"use strict";var t=re(),e=ae(),r={origin:"*",methods:"GET,HEAD,PUT,PATCH,POST,DELETE",preflightContinue:!1,optionsSuccessStatus:204};function s(n){return typeof n=="string"||n instanceof String}function o(n,a){if(Array.isArray(a)){for(var c=0;c<a.length;++c)if(o(n,a[c]))return!0;return!1}else return s(a)?n===a:a instanceof RegExp?a.test(n):!!a}function i(n,a){var c=a.headers.origin,d=[],p;return!n.origin||n.origin==="*"?d.push([{key:"Access-Control-Allow-Origin",value:"*"}]):s(n.origin)?(d.push([{key:"Access-Control-Allow-Origin",value:n.origin}]),d.push([{key:"Vary",value:"Origin"}])):(p=o(c,n.origin),d.push([{key:"Access-Control-Allow-Origin",value:p?c:!1}]),d.push([{key:"Vary",value:"Origin"}])),d}function u(n){var a=n.methods;return a.join&&(a=n.methods.join(",")),{key:"Access-Control-Allow-Methods",value:a}}function m(n){return n.credentials===!0?{key:"Access-Control-Allow-Credentials",value:"true"}:null}function Re(n,a){var c=n.allowedHeaders||n.headers,d=[];return c?c.join&&(c=c.join(",")):(c=a.headers["access-control-request-headers"],d.push([{key:"Vary",value:"Access-Control-Request-Headers"}])),c&&c.length&&d.push([{key:"Access-Control-Allow-Headers",value:c}]),d}function Z(n){var a=n.exposedHeaders;if(a)a.join&&(a=a.join(","));else return null;return a&&a.length?{key:"Access-Control-Expose-Headers",value:a}:null}function Ue(n){var a=(typeof n.maxAge=="number"||n.maxAge)&&n.maxAge.toString();return a&&a.length?{key:"Access-Control-Max-Age",value:a}:null}function _(n,a){for(var c=0,d=n.length;c<d;c++){var p=n[c];p&&(Array.isArray(p)?_(p,a):p.key==="Vary"&&p.value?e(a,p.value):p.value&&a.setHeader(p.key,p.value))}}function Oe(n,a,c,d){var p=[],v=a.method&&a.method.toUpperCase&&a.method.toUpperCase();v==="OPTIONS"?(p.push(i(n,a)),p.push(m(n,a)),p.push(u(n,a)),p.push(Re(n,a)),p.push(Ue(n,a)),p.push(Z(n,a)),_(p,c),n.preflightContinue?d():(c.statusCode=n.optionsSuccessStatus,c.setHeader("Content-Length","0"),c.end())):(p.push(i(n,a)),p.push(m(n,a)),p.push(Z(n,a)),_(p,c),d())}function Ce(n){var a=null;return typeof n=="function"?a=n:a=function(c,d){d(null,n)},function(d,p,v){a(d,function(Q,De){if(Q)v(Q);else{var h=t({},r,De),U=null;h.origin&&typeof h.origin=="function"?U=h.origin:h.origin&&(U=function(V,O){O(null,h.origin)}),U?U(d.headers.origin,function(V,O){V||!O?v(V):(h.origin=O,Oe(h,d,p,v))}):v()}})}}ie.exports=Ce})()});import{onRequest as Ye}from"firebase-functions/v2/https";var xe=Ne(ne());import we from"express";import{Router as We}from"express";var g=class{constructor(e){this.props=e}get id(){return this.props.id}get title(){return this.props.title}get description(){return this.props.description}get completed(){return this.props.completed}get createdAt(){return this.props.createdAt}get updatedAt(){return this.props.updatedAt}toJSON(){return{id:this.props.id,title:this.props.title,description:this.props.description,completed:this.props.completed,createdAt:this.props.createdAt,updatedAt:this.props.updatedAt,userId:this.props.userId}}get userId(){return this.props.userId}};import*as C from"firebase-admin";import{getFirestore as Ve}from"firebase-admin/firestore";C.apps.length||C.initializeApp();var f=Ve();var T="tasks",k=class{async getAll(){return(await f.collection(T).get()).docs.map(r=>{let s=r.data(),o={id:r.id,title:s.title,description:s.description,completed:s.completed,createdAt:s.createdAt.toDate(),updatedAt:s.updatedAt.toDate(),userId:s.userId};return new g(o)})}async create(e){await f.collection(T).doc(e.id).set(e.toJSON())}async getById(e){let r=await f.collection(T).doc(e).get();if(!r.exists)return null;let s=r.data(),o={id:r.id,title:s.title,description:s.description,completed:s.completed,createdAt:s.createdAt.toDate(),updatedAt:s.updatedAt.toDate(),userId:s.userId};return new g(o)}async update(e){await f.collection(T).doc(e.id).update(e.toJSON())}async delete(e){await f.collection(T).doc(e).delete()}async findByUserId(e){return(await f.collection(T).where("userId","==",e).get()).docs.map(s=>{let o=s.data(),i={id:s.id,title:o.title,description:o.description,completed:o.completed,createdAt:o.createdAt.toDate(),updatedAt:o.updatedAt.toDate(),userId:o.userId};return new g(i)})}};function ue(t){return typeof t.title=="string"&&(t.description===void 0||typeof t.description=="string")}function ce(t){return(t.title===void 0||typeof t.title=="string")&&(t.description===void 0||typeof t.description=="string")&&(t.completed===void 0||typeof t.completed=="boolean")}function D(t){if(!t||typeof t.email!="string")return!1;let e=t.email.trim();return e.length===0?!1:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}var l=[];for(let t=0;t<256;++t)l.push((t+256).toString(16).slice(1));function pe(t,e=0){return(l[t[e+0]]+l[t[e+1]]+l[t[e+2]]+l[t[e+3]]+"-"+l[t[e+4]]+l[t[e+5]]+"-"+l[t[e+6]]+l[t[e+7]]+"-"+l[t[e+8]]+l[t[e+9]]+"-"+l[t[e+10]]+l[t[e+11]]+l[t[e+12]]+l[t[e+13]]+l[t[e+14]]+l[t[e+15]]).toLowerCase()}import Me from"node:crypto";var j=new Uint8Array(256),b=j.length;function B(){return b>j.length-16&&(Me.randomFillSync(j),b=0),j.slice(b,b+=16)}import ze from"node:crypto";var W={randomUUID:ze.randomUUID};function Be(t,e,r){if(W.randomUUID&&!e&&!t)return W.randomUUID();t=t||{};let s=t.random||(t.rng||B)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){r=r||0;for(let o=0;o<16;++o)e[r+o]=s[o];return e}return pe(s)}var $=Be;var S=class{constructor(e){this.taskRepo=e}async execute(e,r){let s=new Date,o=new g({id:$(),title:e.title,description:e.description,completed:!1,createdAt:s,updatedAt:s,userId:r});return await this.taskRepo.create(o),o}};var E=class{constructor(e){this.taskRepo=e}async execute(e,r,s){let o=await this.taskRepo.getById(e);if(!o||o.userId!==s)return null;let i=o.toJSON(),u=new g({...i,title:r.title??i.title,description:r.description??i.description,completed:r.completed??i.completed,updatedAt:new Date});return await this.taskRepo.update(u),u}};var I=class{constructor(e){this.taskRepo=e}async execute(e,r){let s=await this.taskRepo.getById(e);return!s||s.userId!==r?!1:(await this.taskRepo.delete(e),!0)}};var P=class{constructor(e){this.taskRepository=e}async execute(e){return this.taskRepository.findByUserId(e)}};var Ht=new k,N=class{constructor(e){this.taskRepo=e;this.getAllTasks=async(e,r)=>{let s=e.user?.id;if(!s)return r.status(400).json({message:"Usuario no autenticado"});try{let i=await new P(this.taskRepo).execute(s);r.status(200).json(i.map(u=>u.toJSON()))}catch(o){r.status(500).json({message:"Error al obtener tareas",error:o})}};this.createTask=async(e,r)=>{let s=e.user?.id;if(!s)return r.status(400).json({message:"Usuario no autenticado"});let o={...e.body,userId:s};if(!ue(o))return r.status(400).json({message:"Datos inv\xE1lidos"});try{let u=await new S(this.taskRepo).execute(o,s);r.status(201).json(u.toJSON())}catch(i){r.status(500).json({message:"Error al crear tarea",error:i})}};this.updateTask=async(e,r)=>{let s=e.params.id,o=e.body,i=e.user?.id;if(!i)return r.status(400).json({message:"Usuario no autenticado"});if(!ce(o))return r.status(400).json({message:"Datos inv\xE1lidos para actualizar"});try{let m=await new E(this.taskRepo).execute(s,o,i);if(!m)return r.status(404).json({message:"Tarea no encontrada"});r.status(200).json(m.toJSON())}catch(u){r.status(500).json({message:"Error al actualizar tarea",error:u})}};this.deleteTask=async(e,r)=>{let s=e.params.id,o=e.user?.id;if(!o)return r.status(400).json({message:"Usuario no autenticado"});try{if(!await new I(this.taskRepo).execute(s,o))return r.status(404).json({message:"Tarea no encontrada"});r.status(204).send()}catch(i){r.status(500).json({message:"Error al eliminar tarea",error:i})}}}};var y=t=>(e,r,s)=>t(e,r,s).catch(s);import de from"jsonwebtoken";var le=process.env.JWT_SECRET||"4eafe93ce105253227da06bed4d3dedff25b6e22723dc6e0a7b80c3ffad6c559",G=t=>{let e={id:t.id,email:t.email};return de.sign(e,le,{expiresIn:"24h"})},me=t=>de.verify(t,le);var A=(t,e,r)=>{let s=t.headers.authorization?.split(" ")[1];if(!s){e.status(401).json({message:"Acceso denegado, token no proporcionado"});return}try{let o=me(s);t.user={id:o.id,email:o.email},r()}catch(o){e.status(401).json({message:"Token inv\xE1lido o expirado",error:o})}};var R=We(),$e=new k,H=new N($e);R.get("/",A,y(async(t,e)=>{await H.getAllTasks(t,e)}));R.post("/",A,y(async(t,e)=>{await H.createTask(t,e)}));R.put("/:id",A,y(async(t,e)=>{await H.updateTask(t,e)}));R.delete("/:id",A,y(async(t,e)=>{await H.deleteTask(t,e)}));var fe=R;import{Router as Xe}from"express";var w=class{constructor(e){this.id=e.id,this.email=e.email}toJSON(){return{id:this.id,email:this.email}}};var Ge="users",F=class{constructor(e){this.userRepo=e}async execute(e){if(!D(e))throw new Error("Datos de usuario inv\xE1lidos");let{email:r}=e;if(await this.userRepo.getUser(r))throw new Error("El email ya est\xE1 registrado");let i=(await f.collection(Ge).add({email:r})).id,u=new w({id:i,email:r});return await this.userRepo.create(u),u}};var J=class{constructor(e){this.userRepo=e}async execute(e){if(!D(e))throw new Error("Datos de usuario inv\xE1lidos");let{email:r}=e;return this.userRepo.getUser(r)}};var L=class{constructor(e){this.userRepo=e;this.loginUser=async(e,r)=>{let{email:s}=e.body;if(!s||typeof s!="string"){r.status(400).json({message:"Email requerido"});return}try{let i=await new J(this.userRepo).execute({email:s});if(!i){r.status(404).json({message:"Usuario no registrado"});return}let u=G(i);r.status(201).json({user:{...i},token:u})}catch(o){console.error(o),r.status(500).json({message:"Error al buscar usuariox",error:o})}};this.createUser=async(e,r)=>{let{email:s}=e.body;try{let i=await new F(this.userRepo).execute({email:s}),u=G(i);r.status(201).json({user:{...i},token:u})}catch(o){console.error(o),r.status(500).json({message:"Error al crear usuario",error:o})}}}};var ge="users",q=class{async getUser(e){let r=await f.collection(ge).where("email","==",e).get();if(r.empty)return null;let s=r.docs[0].data();return s?new w({id:s.id,email:s.email}):null}async create(e){await f.collection(ge).doc(e.id).set(e.toJSON())}};var X=Xe(),Ke=new q,ye=new L(Ke);X.post("/login",y(ye.loginUser));X.post("/",y(ye.createUser));var he=X;var ve={origin:!0};import Ze from"swagger-jsdoc";import Te from"swagger-ui-express";var Qe={definition:{openapi:"3.0.0",info:{title:"API de Tareas",version:"1.0.0",description:"Documentaci\xF3n de la API de Tareas con Swagger"},components:{securitySchemes:{bearerAuth:{type:"http",scheme:"bearer",bearerFormat:"JWT"}}},security:[{bearerAuth:[]}]},apis:["./src/interfaces/http/routes/*.ts"]},K=Ze(Qe);function ke(t){t.get("/docs/swagger.json",(e,r)=>{r.setHeader("Content-Type","application/json"),r.send(K)}),t.use("/docs",Te.serveFiles(K),Te.setup(K,{explorer:!0,customSiteTitle:"API de Tareas",swaggerUrl:"./docs/swagger.json"}))}var x=we();x.use((0,xe.default)(ve));x.use(we.json());ke(x);x.use("/tasks",fe);x.use("/users",he);var Ae=x;var Or=Ye(Ae);export{Or as api};
/*! Bundled license information:

object-assign/index.js:
  (*
  object-assign
  (c) Sindre Sorhus
  @license MIT
  *)

vary/index.js:
  (*!
   * vary
   * Copyright(c) 2014-2017 Douglas Christopher Wilson
   * MIT Licensed
   *)
*/
